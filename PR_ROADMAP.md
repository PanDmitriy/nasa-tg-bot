# Roadmap Pull Request'–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å Pull Request'–æ–≤ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á –∏–∑ `CODE_AUDIT.md`.

---

## üìã –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ PR'–æ–≤

1. **–ù–µ–±–æ–ª—å—à–∏–µ –∏ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** ‚Äî –∫–∞–∂–¥—ã–π PR —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî PR'—ã –º–æ–∂–Ω–æ –º–µ—Ä–∂–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –∫–∞–∂–¥—ã–π PR –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üü¢ –°—Ä–æ—á–Ω–æ (Critical) ‚Äî 6 PR'–æ–≤

### PR #1: –î–æ–±–∞–≤–∏—Ç—å .env.example –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 15 –º–∏–Ω—É—Ç  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.example` —Å–æ –≤—Å–µ–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–∏—Ç—å README —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `.env.example` —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `README.md` ‚Äî —É–±—Ä–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ `.env.example` (–µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `.env.example` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–§–∞–π–ª—ã:**
- `.env.example` (–Ω–æ–≤—ã–π)
- `README.md`

**–ü—Ä–∏–º–µ—Ä `.env.example`:**
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
NASA_API_KEY=your_nasa_api_key
DATABASE_URL=file:./data/bot.db
NODE_ENV=development

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
SENTRY_DSN=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
DOMAIN_URL=http://localhost:3000
WEBHOOK_PORT=3000
```

---

### PR #2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Dockerfile –∏ Makefile
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–û–±–Ω–æ–≤–∏—Ç—å Dockerfile –¥–æ Node.js 18, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ —Å Prisma –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º—è –æ–±—Ä–∞–∑–∞ –≤ Makefile.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `Dockerfile` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `node:18-alpine`
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–∞–Ω–¥ –≤ Dockerfile (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Prisma schema –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `Makefile` ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å `tg-gpt-chat` –Ω–∞ `nasa-tg-bot`
- [ ] –î–æ–±–∞–≤–∏—Ç—å HEALTHCHECK –≤ Dockerfile (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª—ã:**
- `Dockerfile`
- `Makefile`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Dockerfile:**
```dockerfile
FROM node:18-alpine
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package files
COPY package*.json ./
COPY prisma ./prisma/

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm ci

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Prisma client
RUN npm run db:generate

# –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
```

---

### PR #3: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ zod
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #1 (–¥–ª—è .env.example)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ó–∞–º–µ–Ω–∏—Ç—å —Ä—É—á–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ zod.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `zod` (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω): `npm install zod`
- [ ] –°–æ–∑–¥–∞—Ç—å `src/app/config/validation.ts` —Å zod —Å—Ö–µ–º–æ–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/app/config/development.ts` –∏ `production.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ env
- [ ] –£–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `validateConfig()` –∏–∑ `src/app/index.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –≤ `src/app/types/index.ts` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–§–∞–π–ª—ã:**
- `src/app/config/validation.ts` (–Ω–æ–≤—ã–π)
- `src/app/config/development.ts`
- `src/app/config/production.ts`
- `src/app/index.ts`
- `package.json` (–¥–æ–±–∞–≤–∏—Ç—å zod –≤ dependencies)

**–ü—Ä–∏–º–µ—Ä `src/app/config/validation.ts`:**
```typescript
import { z } from 'zod';

const envSchema = z.object({
  TELEGRAM_BOT_TOKEN: z.string().min(1, 'TELEGRAM_BOT_TOKEN is required'),
  NASA_API_KEY: z.string().min(1, 'NASA_API_KEY is required'),
  DATABASE_URL: z.string().default('file:./data/bot.db'),
  NODE_ENV: z.enum(['development', 'production']).default('development'),
  SENTRY_DSN: z.string().optional(),
  STRIPE_SECRET_KEY: z.string().optional(),
  STRIPE_WEBHOOK_SECRET: z.string().optional(),
  DOMAIN_URL: z.string().default('http://localhost:3000'),
  WEBHOOK_PORT: z.string().transform(Number).pipe(z.number().int().positive()).default('3000'),
});

export type Env = z.infer<typeof envSchema>;

export function validateEnv(): Env {
  try {
    return envSchema.parse(process.env);
  } catch (error) {
    if (error instanceof z.ZodError) {
      console.error('–û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:');
      error.errors.forEach((err) => {
        console.error(`  - ${err.path.join('.')}: ${err.message}`);
      });
    }
    process.exit(1);
  }
}
```

---

### PR #4: –ó–∞–º–µ–Ω–∏—Ç—å any —Ç–∏–ø—ã –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `any` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/entities/subscription/types.ts` —Å —Ç–∏–ø–∞–º–∏ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/features/subscriptions/subscription.service.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã –≤–º–µ—Å—Ç–æ `Record<string, any>`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/schedulers/subscription.scheduler.ts` ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å `any` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/features/subscriptions/commands.unsubscribe.ts` ‚Äî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å `buttons`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/features/subscriptions/commands.subscribe.ts` ‚Äî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å `hourButtons`

**–§–∞–π–ª—ã:**
- `src/entities/subscription/types.ts` (–Ω–æ–≤—ã–π)
- `src/features/subscriptions/subscription.service.ts`
- `src/processes/schedulers/subscription.scheduler.ts`
- `src/features/subscriptions/commands.unsubscribe.ts`
- `src/features/subscriptions/commands.subscribe.ts`

**–ü—Ä–∏–º–µ—Ä `src/entities/subscription/types.ts`:**
```typescript
export interface EarthSubscriptionParams {
  type: 'natural' | 'enhanced';
}

export interface DonkiSubscriptionParams {
  eventType: 'cme' | 'notifications' | 'wsaenlil';
  alertLevel?: 'extreme' | 'high' | 'all';
}

export type SubscriptionParams = EarthSubscriptionParams | DonkiSubscriptionParams | null;

export interface SubscriptionWithParams {
  id: number;
  telegramId: string;
  chatId: string;
  type: 'apod' | 'earth' | 'donki';
  params: SubscriptionParams;
  hourUtc: number;
  enabled: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

---

### PR #5: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ action handlers
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 1.5 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–û–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ action handlers –≤ try-catch –∏ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/bot/index.ts` ‚Äî –æ–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ action handlers –≤ try-catch
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/notifications/donki-notifications.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å await –¥–ª—è `.catch()`
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–§–∞–π–ª—ã:**
- `src/processes/bot/index.ts`
- `src/processes/notifications/donki-notifications.ts`

**–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```typescript
// –í bot/index.ts
this.bot.action(/^donki_cme_(today|week|month|7days)$/, async (ctx) => {
  try {
    if ('data' in ctx.callbackQuery) {
      const period = ctx.callbackQuery.data.split('_').pop();
      const days = period === 'today' ? 1 : period === 'week' ? 7 : period === 'month' ? 30 : 7;
      await handleDonkiCMEData(ctx as BotContext, days);
    }
  } catch (error) {
    await handleTelegramError(ctx as BotContext, error, 'DonkiCME');
  }
});
```

---

### PR #6: –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π NasaAPI –∫–ª–∞—Å—Å
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ  
**–û—Ü–µ–Ω–∫–∞:** 15 –º–∏–Ω—É—Ç  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–ª–∞—Å—Å `NasaAPI` –∏–∑ `src/features/nasa/api.ts`.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `src/features/nasa/api.ts` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∏–≥–¥–µ
- [ ] –£–¥–∞–ª–∏—Ç—å `src/features/nasa/api.ts`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `src/features/nasa/formatters.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —É–¥–∞–ª–∏—Ç—å)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–§–∞–π–ª—ã:**
- `src/features/nasa/api.ts` (—É–¥–∞–ª–∏—Ç—å)
- `src/features/nasa/formatters.ts` (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî 9 PR'–æ–≤

### PR #7: –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π logger —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 1.5 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π logger –¥–ª—è –∑–∞–º–µ–Ω—ã `console.error` –∏ `console.log` –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Sentry.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/logger/index.ts` —Å –µ–¥–∏–Ω—ã–º logger
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `console.error` –Ω–∞ `logger.error` –≤ scheduler –∏ notifications
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `console.log` –Ω–∞ `logger.info` –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ console

**–§–∞–π–ª—ã:**
- `src/shared/logger/index.ts` (–Ω–æ–≤—ã–π)
- `src/processes/schedulers/subscription.scheduler.ts`
- `src/processes/notifications/donki-notifications.ts`
- `src/processes/bot/index.ts`
- –î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã —Å console.log/error

**–ü—Ä–∏–º–µ—Ä `src/shared/logger/index.ts`:**
```typescript
import * as Sentry from '@sentry/node';

interface LogContext {
  [key: string]: any;
}

export const logger = {
  error: (message: string, error?: unknown, context?: LogContext) => {
    console.error(`[ERROR] ${message}`, error, context);
    if (error) {
      Sentry.captureException(error instanceof Error ? error : new Error(String(error)), {
        extra: context,
        tags: { logger: 'error' },
      });
    }
  },
  
  info: (message: string, context?: LogContext) => {
    console.log(`[INFO] ${message}`, context);
  },
  
  warn: (message: string, context?: LogContext) => {
    console.warn(`[WARN] ${message}`, context);
    Sentry.captureMessage(message, {
      level: 'warning',
      extra: context,
    });
  },
  
  debug: (message: string, context?: LogContext) => {
    if (process.env.NODE_ENV === 'development') {
      console.debug(`[DEBUG] ${message}`, context);
    }
  },
};
```

---

### PR #8: –†–∞—Å—à–∏—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #7 (logger)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (SubscriptionService, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏) –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/shared/di/container.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å SubscriptionService
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/schedulers/subscription.scheduler.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å container.subscriptionService
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (setSubscriptionService)

**–§–∞–π–ª—ã:**
- `src/shared/di/container.ts`
- `src/processes/schedulers/subscription.scheduler.ts`

**–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```typescript
// –í container.ts
import { SubscriptionService } from '../../features/subscriptions/subscription.service';

class DIContainer {
  private _subscriptionService: SubscriptionService | null = null;
  
  get subscriptionService(): SubscriptionService {
    if (!this._subscriptionService) {
      this._subscriptionService = new SubscriptionService();
    }
    return this._subscriptionService;
  }
  
  setSubscriptionService(service: SubscriptionService): void {
    this._subscriptionService = service;
  }
}
```

---

### PR #9: –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #8

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è User, Subscription –∏ Premium, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Prisma –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/db/repositories/user.repository.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/db/repositories/subscription.repository.ts` (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫)
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/db/repositories/premium.repository.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/features/subscriptions/subscription.service.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–§–∞–π–ª—ã:**
- `src/shared/db/repositories/user.repository.ts` (–Ω–æ–≤—ã–π)
- `src/shared/db/repositories/subscription.repository.ts` (–Ω–æ–≤—ã–π)
- `src/shared/db/repositories/premium.repository.ts` (–Ω–æ–≤—ã–π)
- `src/features/subscriptions/subscription.service.ts`
- `src/shared/di/container.ts`

**–ü—Ä–∏–º–µ—Ä `src/shared/db/repositories/subscription.repository.ts`:**
```typescript
import { prisma } from '../prisma';
import { SubscriptionParams } from '../../../entities/subscription/types';

export class SubscriptionRepository {
  async create(data: {
    telegramId: string;
    chatId: string;
    type: 'apod' | 'earth' | 'donki';
    hourUtc: number;
    params?: SubscriptionParams;
  }) {
    return prisma.subscription.create({
      data: {
        telegramId: data.telegramId,
        chatId: data.chatId,
        type: data.type,
        hourUtc: data.hourUtc,
        params: data.params ?? undefined,
        enabled: true,
      },
    });
  }
  
  async findByChat(chatId: string) {
    return prisma.subscription.findMany({
      where: { chatId },
      orderBy: { createdAt: 'desc' },
    });
  }
  
  async findEnabled() {
    return prisma.subscription.findMany({
      where: { enabled: true },
      orderBy: { hourUtc: 'asc' },
    });
  }
  
  // ... –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã
}
```

---

### PR #10: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ FSD ‚Äî —É–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ features –æ—Ç processes
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 3 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #4, PR #9

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –≤ shared –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∏–∑ features –≤ processes.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/types/telegram.ts` —Å –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ Telegram –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `src/features/subscriptions/commands.subscribe.ts` ‚Üí `src/processes/bot/handlers/subscriptions/subscribe.ts`
- [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `src/features/subscriptions/commands.unsubscribe.ts` ‚Üí `src/processes/bot/handlers/subscriptions/unsubscribe.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `src/processes/bot/index.ts`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –∏–∑ shared

**–§–∞–π–ª—ã:**
- `src/shared/types/telegram.ts` (–Ω–æ–≤—ã–π)
- `src/processes/bot/handlers/subscriptions/subscribe.ts` (–Ω–æ–≤—ã–π, –ø–µ—Ä–µ–º–µ—â–µ–Ω)
- `src/processes/bot/handlers/subscriptions/unsubscribe.ts` (–Ω–æ–≤—ã–π, –ø–µ—Ä–µ–º–µ—â–µ–Ω)
- `src/features/subscriptions/commands.subscribe.ts` (—É–¥–∞–ª–∏—Ç—å)
- `src/features/subscriptions/commands.unsubscribe.ts` (—É–¥–∞–ª–∏—Ç—å)
- `src/processes/bot/index.ts`

**–ü—Ä–∏–º–µ—Ä `src/shared/types/telegram.ts`:**
```typescript
export interface BaseTelegramContext {
  from?: { id: number; username?: string; first_name?: string };
  chat?: { id: number; type?: string };
  reply: (text: string, options?: any) => Promise<any>;
  answerCbQuery: (text?: string, options?: any) => Promise<boolean>;
  editMessageText: (text: string, options?: any) => Promise<any>;
  deleteMessage: (messageId: number) => Promise<boolean>;
  sendChatAction: (action: string) => Promise<boolean>;
}
```

---

### PR #11: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 1.5 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #10

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ (–≤—Ä–µ–º—è –ø–æ–¥–ø–∏—Å–∫–∏, –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ —Ç.–¥.).

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/lib/validators.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/bot/handlers/subscriptions/subscribe.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/bot/handlers/images.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–§–∞–π–ª—ã:**
- `src/shared/lib/validators.ts` (–Ω–æ–≤—ã–π)
- `src/processes/bot/handlers/subscriptions/subscribe.ts`
- `src/processes/bot/handlers/images.ts`

**–ü—Ä–∏–º–µ—Ä `src/shared/lib/validators.ts`:**
```typescript
export function validateHourUtc(hour: number): { valid: boolean; error?: string } {
  if (!Number.isInteger(hour)) {
    return { valid: false, error: '–ß–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º' };
  }
  if (hour < 0 || hour > 23) {
    return { valid: false, error: '–ß–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23' };
  }
  return { valid: true };
}

export function validateSearchQuery(query: string): { valid: boolean; error?: string } {
  const trimmed = query.trim();
  if (trimmed.length < 2) {
    return { valid: false, error: '–ó–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞' };
  }
  if (trimmed.length > 100) {
    return { valid: false, error: '–ó–∞–ø—Ä–æ—Å –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤' };
  }
  return { valid: true };
}
```

---

### PR #12: –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 1 —á–∞—Å  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #8, PR #9

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –±–æ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (403 –æ—à–∏–±–∫–∞).

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/schedulers/subscription.scheduler.ts` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 403 –æ—à–∏–±–∫—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏ 403
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/processes/notifications/donki-notifications.ts` ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ 403 –µ—Å—Ç—å

**–§–∞–π–ª—ã:**
- `src/processes/schedulers/subscription.scheduler.ts`
- `src/processes/notifications/donki-notifications.ts` (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç—å)

**–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```typescript
private async sendApodNotification(subscription: {...}) {
  try {
    const apod = await container.apodService.getRandomApod();
    // ... –æ—Ç–ø—Ä–∞–≤–∫–∞
  } catch (error: unknown) {
    if (this.isBotBlockedError(error)) {
      await this.subscriptionService.disable(subscription.id, subscription.chatId);
      logger.info(`–ü–æ–¥–ø–∏—Å–∫–∞ ${subscription.id} –æ—Ç–∫–ª—é—á–µ–Ω–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞`);
      return;
    }
    throw error;
  }
}

private isBotBlockedError(error: unknown): boolean {
  if (error && typeof error === 'object' && 'response' in error) {
    const telegramError = error as { response?: { error_code?: number } };
    return telegramError.response?.error_code === 403;
  }
  return false;
}
```

---

### PR #13: –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è NASA API
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 2 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #7

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å in-memory –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è NASA API –æ—Ç–≤–µ—Ç–æ–≤, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `node-cache`: `npm install node-cache @types/node-cache`
- [ ] –°–æ–∑–¥–∞—Ç—å `src/shared/lib/cache.ts` —Å –æ–±–µ—Ä—Ç–∫–æ–π –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/shared/api/nasa.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥ `get`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/features/apod/services/apodService.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à –¥–ª—è —Å–ª—É—á–∞–π–Ω—ã—Ö APOD

**–§–∞–π–ª—ã:**
- `src/shared/lib/cache.ts` (–Ω–æ–≤—ã–π)
- `src/shared/api/nasa.ts`
- `src/features/apod/services/apodService.ts`
- `package.json`

**–ü—Ä–∏–º–µ—Ä `src/shared/lib/cache.ts`:**
```typescript
import NodeCache from 'node-cache';

const cache = new NodeCache({ 
  stdTTL: 3600, // 1 —á–∞—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  checkperiod: 600, // –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
});

export async function getCached<T>(
  key: string,
  fetcher: () => Promise<T>,
  ttl: number = 3600
): Promise<T> {
  const cached = cache.get<T>(key);
  if (cached) {
    return cached;
  }
  
  const data = await fetcher();
  cache.set(key, data, ttl);
  return data;
}

export function clearCache(pattern?: string): void {
  if (pattern) {
    const keys = cache.keys().filter(key => key.includes(pattern));
    cache.del(keys);
  } else {
    cache.flushAll();
  }
}
```

---

### PR #14: –î–æ–±–∞–≤–∏—Ç—å scheduled task –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 1.5 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #7, PR #9

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å scheduler –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ NotificationLog (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π).

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `src/processes/schedulers/cleanup.scheduler.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
- [ ] –ó–∞–ø—É—Å–∫–∞—Ç—å –æ—á–∏—Å—Ç–∫—É —Ä–∞–∑ –≤ –¥–µ–Ω—å (cron: `0 2 * * *` ‚Äî –≤ 2:00 UTC)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `src/app/index.ts`

**–§–∞–π–ª—ã:**
- `src/processes/schedulers/cleanup.scheduler.ts` (–Ω–æ–≤—ã–π)
- `src/app/index.ts`

**–ü—Ä–∏–º–µ—Ä `src/processes/schedulers/cleanup.scheduler.ts`:**
```typescript
import * as cron from 'node-cron';
import { prisma } from '../../shared/db/prisma';
import { logger } from '../../shared/logger';

export class CleanupScheduler {
  private cronJob: cron.ScheduledTask | null = null;
  private isRunning = false;

  public start() {
    if (this.isRunning) {
      logger.warn('CleanupScheduler —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
      return;
    }

    this.isRunning = true;
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC
    this.cronJob = cron.schedule('0 2 * * *', async () => {
      await this.cleanupOldLogs();
    });

    logger.info('CleanupScheduler –∑–∞–ø—É—â–µ–Ω. –û—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC');
  }

  public stop() {
    if (this.cronJob) {
      this.cronJob.stop();
      this.cronJob = null;
    }
    this.isRunning = false;
    logger.info('CleanupScheduler –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }

  private async cleanupOldLogs() {
    try {
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

      const result = await prisma.notificationLog.deleteMany({
        where: {
          createdAt: {
            lt: thirtyDaysAgo,
          },
        },
      });

      logger.info(`–û—á–∏—â–µ–Ω–æ ${result.count} —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ NotificationLog`);
    } catch (error) {
      logger.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤', error);
    }
  }
}
```

---

### PR #15: –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π  
**–û—Ü–µ–Ω–∫–∞:** 4 —á–∞—Å–∞  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** PR #8, PR #9, PR #13

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è ApodService, NasaApi, RateLimiter –∏ SubscriptionService (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ).

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å `tests/unit/features/apod/apodService.spec.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `tests/unit/shared/api/nasa.spec.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `tests/unit/shared/lib/rateLimiter.spec.ts`
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `tests/subscription.service.spec.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–§–∞–π–ª—ã:**
- `tests/unit/features/apod/apodService.spec.ts` (–Ω–æ–≤—ã–π)
- `tests/unit/shared/api/nasa.spec.ts` (–Ω–æ–≤—ã–π)
- `tests/unit/shared/lib/rateLimiter.spec.ts` (–Ω–æ–≤—ã–π)
- `tests/subscription.service.spec.ts` (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–∞:**
```typescript
// tests/unit/features/apod/apodService.spec.ts
import { ApodService } from '../../../src/features/apod/services/apodService';
import { ApodApi } from '../../../src/features/apod/api';
import { container } from '../../../src/shared/di/container';

jest.mock('../../../src/features/apod/api');

describe('ApodService', () => {
  let service: ApodService;
  let mockApi: jest.Mocked<ApodApi>;

  beforeEach(() => {
    mockApi = new ApodApi('test-key') as jest.Mocked<ApodApi>;
    container.setApodApi(mockApi);
    service = container.apodService;
  });

  describe('getRandomApod', () => {
    it('–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π APOD', async () => {
      const mockApod = { /* ... */ };
      mockApi.getApod.mockResolvedValue(mockApod);
      
      const result = await service.getRandomApod();
      
      expect(result).toEqual(mockApod);
      expect(mockApi.getApod).toHaveBeenCalled();
    });
  });
});
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ PR'–æ–≤

| # | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|---|----------|-----------|--------|-------------|
| 1 | –î–æ–±–∞–≤–∏—Ç—å .env.example | üî¥ | 15 –º–∏–Ω | - |
| 2 | –ò—Å–ø—Ä–∞–≤–∏—Ç—å Dockerfile –∏ Makefile | üî¥ | 30 –º–∏–Ω | - |
| 3 | –í–∞–ª–∏–¥–∞—Ü–∏—è env —á–µ—Ä–µ–∑ zod | üî¥ | 1 —á–∞—Å | PR #1 |
| 4 | –ó–∞–º–µ–Ω–∏—Ç—å any —Ç–∏–ø—ã | üî¥ | 2 —á–∞—Å–∞ | - |
| 5 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ handlers | üî¥ | 1.5 —á–∞—Å–∞ | - |
| 6 | –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π NasaAPI | üî¥ | 15 –º–∏–Ω | - |
| 7 | –ï–¥–∏–Ω—ã–π logger | üü° | 1.5 —á–∞—Å–∞ | - |
| 8 | –†–∞—Å—à–∏—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | üü° | 1 —á–∞—Å | PR #7 |
| 9 | –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ | üü° | 2 —á–∞—Å–∞ | PR #8 |
| 10 | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ FSD | üü° | 3 —á–∞—Å–∞ | PR #4, PR #9 |
| 11 | –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ | üü° | 1.5 —á–∞—Å–∞ | PR #10 |
| 12 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | üü° | 1 —á–∞—Å | PR #8, PR #9 |
| 13 | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ NASA API | üü° | 2 —á–∞—Å–∞ | PR #7 |
| 14 | –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ | üü° | 1.5 —á–∞—Å–∞ | PR #7, PR #9 |
| 15 | Unit —Ç–µ—Å—Ç—ã | üü° | 4 —á–∞—Å–∞ | PR #8, PR #9, PR #13 |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ~25 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –º–µ—Ä–∂–∞

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ –º–µ—Ä–∂–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
1. PR #1, PR #2, PR #6 ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ, –º–æ–∂–Ω–æ –º–µ—Ä–∂–∏—Ç—å —Å—Ä–∞–∑—É
2. PR #4 ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π
3. PR #5 ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π
4. PR #3 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #1

### –§–∞–∑–∞ 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. PR #7 ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö PR'–æ–≤
6. PR #8 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #7
7. PR #9 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #8

### –§–∞–∑–∞ 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ª—É—á—à–µ–Ω–∏—è
8. PR #10 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #4, PR #9
9. PR #11 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #10
10. PR #12 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #8, PR #9
11. PR #13 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #7
12. PR #14 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #7, PR #9

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
13. PR #15 ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PR #8, PR #9, PR #13

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PR

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º PR —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

- [ ] –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –ù–µ—Ç –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ (`npm run lint`)
- [ ] –ö–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫ (`npm run build`)
- [ ] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`npm test`)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ª–æ–º–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [ ] PR –∏–º–µ–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–≤—è–∑–∞–Ω —Å –∑–∞–¥–∞—á–µ–π –∏–∑ CODE_AUDIT.md

---

## üîÑ –ü–æ—Å–ª–µ –º–µ—Ä–∂–∞ –≤—Å–µ—Ö PR'–æ–≤

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö PR'–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç** ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ CODE_AUDIT.md —Ä–µ—à–µ–Ω—ã
2. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** ‚Äî README, API docs
3. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
4. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ–ª–∏–∑** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ package.json, —Å–æ–∑–¥–∞—Ç—å changelog

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-XX  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-XX

